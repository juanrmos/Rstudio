"0","# ========================================"
"0","# 7. RANKING DE PROVEEDORES RELEVANTES"
"0","# ========================================"
"0",""
"0","cat(""\n\n=====================================\n"")"
"1","

=====================================
"
"0","cat(""7. RANKING DE PROVEEDORES RELEVANTES\n"")"
"1","7. RANKING DE PROVEEDORES RELEVANTES
"
"0","cat(""=====================================\n\n"")"
"1","=====================================

"
"0","# Top 20 Personas Jurídicas"
"0","top_juridicas <- datos %>%"
"0","  filter(Tipo_Proveedor == ""Persona Jurídica"") %>%"
"0","  group_by(RUC, Razon_Social) %>%"
"0","  summarise("
"0","    Monto_Total = sum(Monto_limpio),"
"0","    Num_Ordenes = n(),"
"0","    Primera_Orden = min(Fecha_Emision),"
"0","    Ultima_Orden = max(Fecha_Emision),"
"0","    Tipos_Contratacion = n_distinct(Tipo_Contratacion),"
"0","    .groups = 'drop'"
"0","  ) %>%"
"0","  # Agregar alertas"
"0","  left_join("
"0","    casos_fraccionamiento %>% "
"0","      select(RUC, Casos_Fraccionamiento = Casos_Detectados),"
"0","    by = ""RUC"""
"0","  ) %>%"
"0","  left_join("
"0","    ordenes_precio_anomalo %>%"
"0","      group_by(RUC) %>%"
"0","      summarise(Ordenes_Sobreprecio = n(), .groups = 'drop'),"
"0","    by = ""RUC"""
"0","  ) %>%"
"0","  mutate("
"0","    Casos_Fraccionamiento = replace_na(Casos_Fraccionamiento, 0),"
"0","    Ordenes_Sobreprecio = replace_na(Ordenes_Sobreprecio, 0),"
"0","    Alertas_Totales = Casos_Fraccionamiento + Ordenes_Sobreprecio,"
"0","    Es_Nuevo_2023 = Primera_Orden >= as.Date(""2023-01-01"")"
"0","  ) %>%"
"0","  arrange(desc(Monto_Total)) %>%"
"0","  head(20)"
"0",""
"0","cat(""TOP 20 PERSONAS JURÍDICAS:\n"")"
"1","TOP 20 PERSONAS JURÍDICAS:
"
"0","cat(""--------------------------\n"")"
"1","--------------------------
"
"0","print(top_juridicas %>% "
"0","      select(RUC, Razon_Social, Monto_Total, Num_Ordenes, "
"0","             Alertas_Totales, Es_Nuevo_2023) %>%"
"0","      mutate(Monto_Total = round(Monto_Total, 0)))"
