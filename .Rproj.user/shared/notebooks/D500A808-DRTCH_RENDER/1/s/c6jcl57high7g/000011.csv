"0","# Análisis mensual para detectar picos"
"0","analisis_mensual <- datos %>%"
"0","  mutate(Año_Mes = floor_date(Fecha_Emision, ""month"")) %>%"
"0","  group_by(Año_Mes) %>%"
"0","  summarise("
"0","    Monto_Mensual = sum(Monto_limpio),"
"0","    Num_Ordenes = n(),"
"0","    .groups = 'drop'"
"0","  ) %>%"
"0","  mutate("
"0","    Cambio_Mensual = (Monto_Mensual - lag(Monto_Mensual)) / lag(Monto_Mensual) * 100"
"0","  )"
"0",""
"0","# Identificar picos y caídas (>50% cambio)"
"0","picos_caidas <- analisis_mensual %>%"
"0","  filter(abs(Cambio_Mensual) > 50, !is.na(Cambio_Mensual)) %>%"
"0","  mutate("
"0","    Tipo = ifelse(Cambio_Mensual > 0, ""PICO"", ""CAÍDA""),"
"0","    Mes_Año = format(Año_Mes, ""%b-%Y"")"
"0","  )"
"0","print(picos_caidas %>% select(Mes_Año, Tipo, Cambio_Mensual, Monto_Mensual))"
