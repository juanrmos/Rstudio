"0","# ========================================"
"0","# 8. GENERACIÃ“N DE SCORE INTEGRAL DE RIESGO"
"0","# ========================================"
"0",""
"0",""
"0","score_integral <- concentracion_proveedores %>%"
"0","  left_join("
"0","    casos_fraccionamiento %>% select(RUC, Casos_Fraccionamiento = Casos_Detectados),"
"0","    by = ""RUC"""
"0","  ) %>%"
"0","  left_join("
"0","    proveedores_nuevos %>% select(RUC, Es_Nuevo_2023 = Primera_Aparicion),"
"0","    by = ""RUC"""
"0","  ) %>%"
"0","  mutate("
"0","    Casos_Fraccionamiento = replace_na(Casos_Fraccionamiento, 0),"
"0","    Es_Nuevo_2023 = !is.na(Es_Nuevo_2023),"
"0","    "
"0","    # Calcular score de riesgo integral"
"0","    Score_Concentracion = ifelse(Participacion_Mercado > 5, 3,"
"0","                                 ifelse(Participacion_Mercado > 2, 2,"
"0","                                       ifelse(Participacion_Mercado > 1, 1, 0))),"
"0","    Score_Fraccionamiento = ifelse(Casos_Fraccionamiento > 5, 3,"
"0","                                   ifelse(Casos_Fraccionamiento > 2, 2,"
"0","                                         ifelse(Casos_Fraccionamiento > 0, 1, 0))),"
"0","    Score_Nuevo = Es_Nuevo_2023 * 2,"
"0","    Score_Una_Orden = (Num_Ordenes == 1 & Monto_Total > quantile(Monto_Total, 0.75)) * 3,"
"0","    "
"0","    SCORE_RIESGO_TOTAL = Score_Concentracion + Score_Fraccionamiento + "
"0","                         Score_Nuevo + Score_Una_Orden"
"0","  ) %>%"
"0","  filter(SCORE_RIESGO_TOTAL >= 3) %>%"
"0","  select(RUC, Razon_Social, Monto_Total, Num_Ordenes, Participacion_Mercado,"
"0","         Casos_Fraccionamiento, Es_Nuevo_2023, SCORE_RIESGO_TOTAL) %>%"
"0","  arrange(desc(SCORE_RIESGO_TOTAL), desc(Monto_Total))"
"0",""
"0",""
"0","print(head(score_integral, 20))"
