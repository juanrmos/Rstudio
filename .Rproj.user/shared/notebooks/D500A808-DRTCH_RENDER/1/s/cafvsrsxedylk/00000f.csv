"0","# ========================================"
"0","# 4. AN√ÅLISIS DE FRACCIONAMIENTO POR TIPO"
"0","# ========================================"
"0",""
"0","cat(""\n\n=====================================\n"")"
"1","

=====================================
"
"0","cat(""4. FRACCIONAMIENTO POR TIPO DE PROVEEDOR\n"")"
"1","4. FRACCIONAMIENTO POR TIPO DE PROVEEDOR
"
"0","cat(""=====================================\n\n"")"
"1","=====================================

"
"0","# Detectar fraccionamiento por tipo de proveedor"
"0","fraccionamiento_por_tipo <- datos %>%"
"0","  arrange(RUC, Fecha_Emision) %>%"
"0","  group_by(RUC) %>%"
"0","  mutate("
"0","    Dias_Entre_Ordenes = as.numeric(Fecha_Emision - lag(Fecha_Emision)),"
"0","    Diferencia_Monto = abs(Monto_limpio - lag(Monto_limpio)),"
"0","    Posible_Fraccionamiento = Dias_Entre_Ordenes <= 7 & "
"0","                              Diferencia_Monto < (Monto_limpio * 0.2) &"
"0","                              !is.na(Dias_Entre_Ordenes)"
"0","  ) %>%"
"0","  filter(Posible_Fraccionamiento == TRUE) %>%"
"0","  left_join(datos %>% select(RUC, Tipo_Proveedor) %>% distinct(), by = ""RUC"") %>% "
"0","  mutate(Tipo_Proveedor = coalesce(Tipo_Proveedor.x, Tipo_Proveedor.y)) %>%"
"0","select(-Tipo_Proveedor.x, -Tipo_Proveedor.y)"
"0",""
"0","resumen_fraccionamiento <- fraccionamiento_por_tipo %>%"
"0","  group_by(Tipo_Proveedor) %>%"
"0","  summarise("
"0","    Casos_Fraccionamiento = n(),"
"0","    Monto_Total_Fraccionado = sum(Monto_limpio),"
"0","    Monto_Promedio_Fraccion = mean(Monto_limpio),"
"0","    Mediana_Fraccion = median(Monto_limpio),"
"0","    Proveedores_Involucrados = n_distinct(RUC),"
"0","    Dias_Promedio_Entre_Ordenes = mean(Dias_Entre_Ordenes, na.rm = TRUE),"
"0","    .groups = 'drop'"
"0","  ) %>%"
"0","  mutate("
"0","    Casos_Por_Proveedor = Casos_Fraccionamiento / Proveedores_Involucrados"
"0","  )"
"0",""
"0","print(resumen_fraccionamiento)"
