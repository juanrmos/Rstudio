"0","# Clasificación simple - CORRECCIÓN AQUÍ"
"0","# Primero calcular el total de datos válidos"
"0","datos_validos <- datos %>% "
"0","  filter(!is.na(Estado_Registro) & Estado_Registro != """")"
"0",""
"0","total_ordenes <- nrow(datos_validos)"
"0",""
"0","cumplimiento <- datos_validos %>%"
"0","  mutate("
"0","    Registro_Oportuno = ifelse(Estado_Registro == ""Registrado dentro de plazo"", ""Sí"", ""No"")"
"0","  ) %>%"
"0","  group_by(Registro_Oportuno) %>%"
"0","  summarise(Cantidad = n()) %>%"
"0","  mutate(Porcentaje = Cantidad / total_ordenes * 100)  # Usar total_ordenes, no nrow(datos)"
"0",""
"0",""
"0","# Verificación: los porcentajes deben sumar 100%"
"0","cat(""Verificación - Suma de porcentajes:"", sum(cumplimiento$Porcentaje), ""%\n"")"
"1","Verificación - Suma de porcentajes:"
"1"," "
"1","100"
"1"," "
"1","%
"
"0","cat(""Total de órdenes analizadas:"", total_ordenes, ""\n"")"
"1","Total de órdenes analizadas:"
"1"," "
"1","137"
"1"," "
"1","
"
"0","# Gráfico circular mejorado"
"0","ggplot(cumplimiento, aes(x = """", y = Porcentaje, fill = Registro_Oportuno)) +"
"0","  geom_bar(stat = ""identity"", width = 1) +"
"0","  coord_polar(""y"") +"
"0","  geom_text(aes(label = paste0(round(Porcentaje, 1), ""%\n("", Cantidad, "" órdenes)"")),"
"0","            position = position_stack(vjust = 0.5),"
"0","            color = ""white"", fontface = ""bold"", size = 4) +"
"0","  labs("
"0","    title = ""Cumplimiento de Plazos de Registro de Órdenes"","
"0","    subtitle = paste0(""Total analizado: "", total_ordenes, "" órdenes""),"
"0","    fill = ""Registro Oportuno"""
"0","  ) +"
"0","  scale_fill_manual("
"0","    values = c(""No"" = ""#e74c3c"", ""Sí"" = ""#27ae60""),  # Rojo para No, Verde para Sí"
"0","    labels = c(""No"" = ""Fuera de Plazo"", ""Sí"" = ""Dentro de Plazo"")"
"0","  ) +"
"0","  theme_void() +"
"0","  theme("
"0","    plot.title = element_text(size = 14, face = ""bold"", hjust = 0.5),"
"0","    plot.subtitle = element_text(size = 11, color = ""gray60"", hjust = 0.5),"
"0","    legend.position = ""bottom"","
"0","    legend.title = element_text(face = ""bold""),"
"0","    legend.text = element_text(size = 11)"
"0","  )"
